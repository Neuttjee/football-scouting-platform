generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Club {
  id             String          @id @default(cuid())
  name           String
  slug           String          @unique
  logoUrl        String?
  primaryColor   String?
  secondaryColor String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  
  users          User[]
  players        Player[]
  contactMoments ContactMoment[]
  tasks          Task[]
}

model User {
  id           String   @id @default(cuid())
  clubId       String
  name         String
  email        String   @unique
  passwordHash String
  role         String   @default("LEZER") // ADMIN, TC_LID, SCOUT, LEZER
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  club         Club     @relation(fields: [clubId], references: [id])
  
  createdPlayers        Player[]        @relation("PlayerCreator")
  createdContactMoments ContactMoment[] @relation("ContactCreator")
  createdTasks          Task[]          @relation("TaskCreator")
  assignedTasks         Task[]          @relation("TaskOwner")

  @@index([clubId])
}

model Player {
  id               String        @id @default(cuid())
  clubId           String
  naam             String
  clubHuidig       String?
  team             String?
  niveauCompetitie String?
  positie          String?
  nevenpositie     String?
  voorkeursbeen    String        @default("ONBEKEND") // LINKS, RECHTS, BEIDE, ONBEKEND
  geboortedatum    DateTime?
  leeftijd         Int?
  contactpersoon   String?
  status           String        @default("TE_VOLGEN") // TE_VOLGEN, ACTIEF, PARKEREN, AFGEVALLEN, GESTOPT, GETEKEND
  processtap       String        @default("LONGLIST") // LONGLIST, SHORTLIST, etc.
  advies           String        @default("NOG_BEKIJKEN") // NOG_BEKIJKEN, BLIJVEN_VOLGEN, etc.
  laatsteUpdateAt  DateTime      @default(now())
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  createdByUserId  String

  club             Club            @relation(fields: [clubId], references: [id])
  createdBy        User            @relation("PlayerCreator", fields: [createdByUserId], references: [id])
  contactMoments   ContactMoment[]
  tasks            Task[]

  @@index([clubId])
}

model ContactMoment {
  id                String      @id @default(cuid())
  clubId            String
  playerId          String
  datumTijd         DateTime    @default(now())
  contactType       String      // INTRO_BENADERING, FOLLOW_UP, GESPREK, MEETTRAINING, AANBOD, OVERIG
  contactTypeFree   String?
  kanaal            String      // WHATSAPP, TELEFOON, OP_DE_CLUB, TRAINING, VIA_DERDE, EMAIL, OVERIG
  kanaalFree        String?
  uitkomst          String?     // POSITIEF, NEUTRAAL, TWIJFEL, NEGATIEF
  samenvatting      String?
  verslag           String?
  reden             String?
  volgendeActieDatum DateTime?
  createdAt         DateTime    @default(now())
  createdByUserId   String

  club      Club   @relation(fields: [clubId], references: [id])
  player    Player @relation(fields: [playerId], references: [id])
  createdBy User   @relation("ContactCreator", fields: [createdByUserId], references: [id])

  @@index([clubId])
  @@index([playerId])
}

model Task {
  id              String     @id @default(cuid())
  clubId          String
  titel           String
  playerId        String?
  eigenaarUserId  String
  deadline        DateTime?
  prioriteit      String     @default("NORMAAL") // LAAG, NORMAAL, HOOG
  status          String     @default("OPEN") // OPEN, IN_UITVOERING, GEREED
  notitie         String?
  createdAt       DateTime   @default(now())
  createdByUserId String
  afgerondAt      DateTime?

  club      Club    @relation(fields: [clubId], references: [id])
  player    Player? @relation(fields: [playerId], references: [id])
  eigenaar  User    @relation("TaskOwner", fields: [eigenaarUserId], references: [id])
  createdBy User    @relation("TaskCreator", fields: [createdByUserId], references: [id])

  @@index([clubId])
  @@index([eigenaarUserId])
}