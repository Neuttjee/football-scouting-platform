generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Club {
  id             String          @id @default(uuid())
  name           String
  logo           String?
  primaryColor   String?
  secondaryColor String?

  users          User[]
  players        Player[]
  contacts       ContactMoment[]
  tasks          Task[]

  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model User {
  id                   String    @id @default(uuid())
  email                String    @unique
  passwordHash         String?
  name                 String
  role                 String    // "ADMIN", "TC_LID", "SCOUT", "LEZER"
  isActive             Boolean   @default(true)

  inviteToken          String?   @unique
  inviteTokenExpires   DateTime?

  clubId               String
  club                 Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)

  // 2FA Fields (Post-MVP)
  twoFactorEnabled     Boolean   @default(false)
  twoFactorSecret      String?
  twoFactorBackupCodes String?
  twoFactorVerifiedAt  DateTime?

  // Audit Relations
  playersCreated       Player[]        @relation("PlayerCreatedBy")
  contactsCreated      ContactMoment[] @relation("ContactCreatedBy")
  tasksCreated         Task[]          @relation("TaskCreatedBy")
  tasksAssigned        Task[]          @relation("TaskAssignedTo")

  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
}

model Player {
  id                    String   @id @default(uuid())
  name                  String
  position              String?
  dateOfBirth           DateTime?

  // Target status logic
  step                  String?
  status                String?
  statusManuallyChanged Boolean  @default(false)

  clubId                String
  club                  Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)

  createdById           String?
  createdBy             User?    @relation("PlayerCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

  contacts              ContactMoment[]

  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model ContactMoment {
  id          String   @id @default(uuid())
  type        String
  channel     String
  outcome     String?
  reason      String?
  notes       String?

  playerId    String
  player      Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)

  clubId      String
  club        Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)

  createdById String?
  createdBy   User?    @relation("ContactCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Task {
  id           String   @id @default(uuid())
  title        String
  description  String?
  isCompleted  Boolean  @default(false)

  clubId       String
  club         Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)

  assignedToId String?
  assignedTo   User?    @relation("TaskAssignedTo", fields: [assignedToId], references: [id], onDelete: SetNull)

  createdById  String?
  createdBy    User?    @relation("TaskCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
